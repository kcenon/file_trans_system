From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: kcenon <kcenon@naver.com>
Date: Mon, 23 Dec 2024 01:00:00 +0900
Subject: [PATCH] fix(adapter): use log_entry for common_system ILogger
 compatibility

The common_system ILogger interface (v3.0.0) removed the deprecated
log(level, message, file, line, function) overload. It was replaced
with source_location-based API per Issue #217.

Update the adapter and logger integration to use the log_entry-based
overload instead, which accepts file, line, and function fields
through the log_entry struct.
---
 include/kcenon/network/integration/common_system_adapter.h | 11 ++++++++-
 src/integration/logger_integration.cpp                     | 34 ++++-------
 2 files changed, 24 insertions(+), 21 deletions(-)

diff --git a/include/kcenon/network/integration/common_system_adapter.h b/include/kcenon/network/integration/common_system_adapter.h
index 0000000..0000001 100644
--- a/include/kcenon/network/integration/common_system_adapter.h
+++ b/include/kcenon/network/integration/common_system_adapter.h
@@ -181,7 +181,16 @@ public:
         if (!logger_) {
             return;
         }
-        logger_->log(to_common_log_level(level), message, file, line, function);
+        // Use log_entry to pass file/line/function since the direct overload
+        // was removed in common_system v3.0.0 (Issue #217)
+        ::kcenon::common::interfaces::log_entry entry;
+        entry.level = to_common_log_level(level);
+        entry.message = message;
+        entry.file = file;
+        entry.line = line;
+        entry.function = function;
+        entry.timestamp = std::chrono::system_clock::now();
+        logger_->log(entry);
     }

     bool is_level_enabled(log_level level) const override {
diff --git a/src/integration/logger_integration.cpp b/src/integration/logger_integration.cpp
index 0000000..0000001 100644
--- a/src/integration/logger_integration.cpp
+++ b/src/integration/logger_integration.cpp
@@ -109,20 +109,16 @@ void common_system_logger_adapter::log(log_level level, const std::string& messa
                                        const std::string& function) {
     auto logger = get_logger();
     if (logger) {
-        // Use the deprecated interface for backward compatibility
-#if defined(__GNUC__) || defined(__clang__)
-    #pragma GCC diagnostic push
-    #pragma GCC diagnostic ignored "-Wdeprecated-declarations"
-#elif defined(_MSC_VER)
-    #pragma warning(push)
-    #pragma warning(disable: 4996)
-#endif
-        logger->log(to_common_level(level), message, file, line, function);
-#if defined(__GNUC__) || defined(__clang__)
-    #pragma GCC diagnostic pop
-#elif defined(_MSC_VER)
-    #pragma warning(pop)
-#endif
+        // Use log_entry to pass file/line/function since the direct overload
+        // was removed in common_system v3.0.0 (Issue #217)
+        ::kcenon::common::interfaces::log_entry entry;
+        entry.level = to_common_level(level);
+        entry.message = message;
+        entry.file = file;
+        entry.line = line;
+        entry.function = function;
+        entry.timestamp = std::chrono::system_clock::now();
+        logger->log(entry);
     }
 }

@@ -299,19 +295,16 @@ void common_system_logger_adapter::log(log_level level, const std::string& messa
         // Delegate directly to common_system's GlobalLoggerRegistry
         auto common_logger = kcenon::common::interfaces::get_logger();
         if (common_logger) {
-#if defined(__GNUC__) || defined(__clang__)
-    #pragma GCC diagnostic push
-    #pragma GCC diagnostic ignored "-Wdeprecated-declarations"
-#elif defined(_MSC_VER)
-    #pragma warning(push)
-    #pragma warning(disable: 4996)
-#endif
-            common_logger->log(to_common_level(level), message, file, line, function);
-#if defined(__GNUC__) || defined(__clang__)
-    #pragma GCC diagnostic pop
-#elif defined(_MSC_VER)
-    #pragma warning(pop)
-#endif
+            // Use log_entry to pass file/line/function since the direct overload
+            // was removed in common_system v3.0.0 (Issue #217)
+            ::kcenon::common::interfaces::log_entry entry;
+            entry.level = to_common_level(level);
+            entry.message = message;
+            entry.file = file;
+            entry.line = line;
+            entry.function = function;
+            entry.timestamp = std::chrono::system_clock::now();
+            common_logger->log(entry);
         }
 #else
         auto logger = get_logger();
-- 
2.50.1 (Apple Git-155)
